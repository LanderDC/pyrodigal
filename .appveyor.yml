version: '{build}'
clone_depth: 5
environment:
  matrix:
  - PYTHON: "C:\\Python35-x64"
    PYTHON_VERSION: "3.5"
    PYTHON_ARCH: "64"
  - PYTHON: "C:\\Python36-x64"
    PYTHON_VERSION: "3.6"
    PYTHON_ARCH: "64"
  - PYTHON: "C:\\Python37-x64"
    PYTHON_VERSION: "3.7"
    PYTHON_ARCH: "64"
  - PYTHON: "C:\\Python38-x64"
    PYTHON_VERSION: "3.8"
    PYTHON_ARCH: "64"

install:
- "git submodule update --init"
- "%PYTHON%\\python.exe -m pip install -r ci\\requirements.txt"

before_build:
- "%PYTHON%\\python.exe -V"

build_script:
- "%PYTHON%\\python.exe setup.py build_ext --inplace"

test_script:
- "%PYTHON%\\python.exe -m pip install -r tests\\requirements.txt"
- "%PYTHON%\\python.exe -m unittest discover -b -v"

before_deploy:
- "%WITH_ENV% %PYTHON%\\python.exe setup.py sdist bdist_wheel"

deploy_script:
- ps: .\ci\appveyor\deploy.ps1
